<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SOON - Telegram Web App</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ton-connect-ui/2.0.0/ton-connect-ui.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            overflow-x: hidden;
            min-height: 100vh;
            position: relative;
        }

        .container {
            position: relative;
            width: 100%;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10;
            gap: 2rem;
            padding: 2rem 1rem;
        }

        .points-display {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 15px;
            padding: 0.8rem 1.2rem;
            color: white;
            font-weight: 600;
            font-size: 1.1rem;
            z-index: 100;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .countdown-container {
            text-align: center;
        }

        .countdown-title {
            color: #fff;
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 1rem;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
        }

        .countdown {
            display: flex;
            gap: 1.5rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        .time-block {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            padding: 1rem;
            min-width: 80px;
            text-align: center;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .time-value {
            display: block;
            font-size: 2rem;
            font-weight: 900;
            color: #fff;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.3);
        }

        .time-label {
            display: block;
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.8);
            margin-top: 0.5rem;
            font-weight: 500;
        }

        .soon-text {
            font-size: clamp(4rem, 15vw, 12rem);
            font-weight: 900;
            color: #fff;
            text-shadow: 
                0 0 20px rgba(255, 255, 255, 0.5),
                0 0 40px rgba(255, 255, 255, 0.3),
                0 0 60px rgba(255, 255, 255, 0.1);
            letter-spacing: 0.1em;
            animation: pulse 2s ease-in-out infinite alternate;
        }

        @keyframes pulse {
            from {
                transform: scale(1);
                text-shadow: 
                    0 0 20px rgba(255, 255, 255, 0.5),
                    0 0 40px rgba(255, 255, 255, 0.3),
                    0 0 60px rgba(255, 255, 255, 0.1);
            }
            to {
                transform: scale(1.05);
                text-shadow: 
                    0 0 30px rgba(255, 255, 255, 0.8),
                    0 0 60px rgba(255, 255, 255, 0.5),
                    0 0 90px rgba(255, 255, 255, 0.3);
            }
        }

        .tasks-container {
            width: 100%;
            max-width: 400px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            padding: 1.5rem;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .tasks-title {
            color: #fff;
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 1rem;
            text-align: center;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
        }

        .task-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            padding: 1rem;
            margin-bottom: 0.8rem;
            transition: all 0.3s ease;
        }

        .task-item:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-2px);
        }

        .task-item.completed {
            background: rgba(76, 175, 80, 0.3);
            border-color: rgba(76, 175, 80, 0.5);
        }

        .task-item.checking {
            background: rgba(255, 193, 7, 0.3);
            border-color: rgba(255, 193, 7, 0.5);
        }

        .task-info {
            display: flex;
            align-items: center;
            gap: 0.8rem;
        }

        .task-icon {
            font-size: 1.5rem;
        }

        .task-details {
            display: flex;
            flex-direction: column;
        }

        .task-name {
            color: #fff;
            font-weight: 600;
            font-size: 1rem;
        }

        .task-reward {
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.9rem;
            margin-top: 0.2rem;
        }

        .task-button {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 25px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            min-width: 100px;
        }

        .task-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.4);
        }

        .task-button:disabled {
            background: rgba(255, 255, 255, 0.3);
            cursor: not-allowed;
            transform: none;
        }

        .task-button.completed {
            background: linear-gradient(45deg, #2196F3, #1976D2);
        }

        .task-button.checking {
            background: linear-gradient(45deg, #FF9800, #F57C00);
        }

        .wallet-section {
            width: 100%;
            max-width: 400px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            padding: 1.5rem;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .wallet-title {
            color: #fff;
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 1rem;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
        }

        .wallet-button {
            background: linear-gradient(45deg, #0098EA, #0076D3);
            border: none;
            padding: 1rem 2rem;
            border-radius: 50px;
            color: white;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .wallet-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        .wallet-button:disabled {
            background: rgba(76, 175, 80, 0.8);
            cursor: not-allowed;
            transform: none;
        }

        .wallet-info {
            color: rgba(255, 255, 255, 0.9);
            font-size: 0.9rem;
            margin-top: 0.5rem;
        }

        .referral-section {
            width: 100%;
            max-width: 400px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            padding: 1.5rem;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .referral-title {
            color: #fff;
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 1rem;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
        }

        .referral-stats {
            display: flex;
            justify-content: space-around;
            margin-bottom: 1rem;
        }

        .stat-item {
            text-align: center;
        }

        .stat-number {
            color: #fff;
            font-size: 1.5rem;
            font-weight: 900;
            display: block;
        }

        .stat-label {
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.9rem;
            margin-top: 0.2rem;
        }

        .referral-link {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            padding: 0.8rem;
            color: #fff;
            font-size: 0.9rem;
            word-break: break-all;
            margin-bottom: 1rem;
        }

        .copy-button {
            background: linear-gradient(45deg, #9c27b0, #673ab7);
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 25px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
        }

        .copy-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(156, 39, 176, 0.4);
        }

        .copy-button:disabled {
            background: rgba(255, 255, 255, 0.3);
            cursor: not-allowed;
            transform: none;
        }

        .stickers-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
            pointer-events: none;
        }

        .sticker {
            position: absolute;
            font-size: 3rem;
            animation: float 8s ease-in-out infinite;
            opacity: 0.6;
        }

        @keyframes float {
            0%, 100% {
                transform: translateY(0px) rotate(0deg);
            }
            25% {
                transform: translateY(-20px) rotate(5deg);
            }
            50% {
                transform: translateY(-40px) rotate(0deg);
            }
            75% {
                transform: translateY(-20px) rotate(-5deg);
            }
        }

        .sticker:nth-child(1) { top: 10%; left: 10%; animation-delay: 0s; font-size: 2.5rem; }
        .sticker:nth-child(2) { top: 20%; right: 15%; animation-delay: 1s; font-size: 3.5rem; }
        .sticker:nth-child(3) { bottom: 25%; left: 8%; animation-delay: 2s; font-size: 2.8rem; }
        .sticker:nth-child(4) { bottom: 15%; right: 20%; animation-delay: 3s; font-size: 3.2rem; }
        .sticker:nth-child(5) { top: 50%; left: 5%; animation-delay: 4s; font-size: 2.3rem; }
        .sticker:nth-child(6) { top: 60%; right: 10%; animation-delay: 5s; font-size: 3.8rem; }
        .sticker:nth-child(7) { top: 35%; left: 85%; animation-delay: 6s; font-size: 2.6rem; }
        .sticker:nth-child(8) { bottom: 40%; right: 5%; animation-delay: 7s; font-size: 3.1rem; }

        .loading-spinner {
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-top: 2px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error-message {
            color: #ff6b6b;
            font-size: 0.9rem;
            margin-top: 0.5rem;
            text-align: center;
        }

        .success-message {
            color: #4CAF50;
            font-size: 0.9rem;
            margin-top: 0.5rem;
            text-align: center;
        }

        .notification {
            position: fixed;
            top: 100px;
            right: 20px;
            background: rgba(76, 175, 80, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(76, 175, 80, 0.5);
            border-radius: 15px;
            padding: 1rem;
            color: white;
            font-weight: 600;
            z-index: 1000;
            transform: translateX(100%);
            transition: transform 0.3s ease;
        }

        .notification.show {
            transform: translateX(0);
        }

        /* –ú–æ–±–∏–ª—å–Ω–∞—è –∞–¥–∞–ø—Ç–∞—Ü–∏—è */
        @media (max-width: 768px) {
            .points-display {
                top: 10px;
                right: 10px;
                padding: 0.6rem 1rem;
                font-size: 1rem;
            }
            
            .container {
                padding: 1rem;
                gap: 1.5rem;
            }
            
            .tasks-container,
            .wallet-section,
            .referral-section {
                max-width: 100%;
                padding: 1rem;
            }
            
            .soon-text {
                font-size: clamp(3rem, 12vw, 8rem);
            }
            
            .countdown {
                gap: 1rem;
            }
            
            .time-block {
                min-width: 70px;
                padding: 0.8rem;
            }
            
            .time-value {
                font-size: 1.5rem;
            }
            
            .task-item {
                flex-direction: column;
                gap: 0.8rem;
                text-align: center;
            }
            
            .task-info {
                flex-direction: column;
                gap: 0.5rem;
            }
            
            .sticker {
                font-size: 2rem;
            }

            .notification {
                top: 80px;
                right: 10px;
                left: 10px;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <div class="points-display">
        <span id="points">0</span> XP
    </div>

    <div class="stickers-container">
        <div class="sticker">üéâ</div>
        <div class="sticker">üöÄ</div>
        <div class="sticker">‚≠ê</div>
        <div class="sticker">üî•</div>
        <div class="sticker">üíé</div>
        <div class="sticker">üéä</div>
        <div class="sticker">‚ö°</div>
        <div class="sticker">üåü</div>
    </div>

    <div class="container">
        <h1 class="soon-text">SOON</h1>
        
        <div class="countdown-container">
            <div class="countdown-title">–ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑:</div>
            <div class="countdown" id="countdown">
                <div class="time-block">
                    <span class="time-value" id="days">00</span>
                    <span class="time-label">–¥–Ω–µ–π</span>
                </div>
                <div class="time-block">
                    <span class="time-value" id="hours">00</span>
                    <span class="time-label">—á–∞—Å–æ–≤</span>
                </div>
                <div class="time-block">
                    <span class="time-value" id="minutes">00</span>
                    <span class="time-label">–º–∏–Ω—É—Ç</span>
                </div>
                <div class="time-block">
                    <span class="time-value" id="seconds">00</span>
                    <span class="time-label">—Å–µ–∫—É–Ω–¥</span>
                </div>
            </div>
        </div>

        <div class="wallet-section">
            <div class="wallet-title">–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫–æ—à–µ–ª—å–∫–∞</div>
            <button class="wallet-button" id="connectWallet">
                <span id="walletIcon">üíé</span>
                <span id="walletText">–ü–æ–¥–∫–ª—é—á–∏—Ç—å TON –∫–æ—à–µ–ª–µ–∫</span>
            </button>
            <div class="wallet-info">1,000 XP –∑–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ</div>
            <div id="walletError" class="error-message" style="display: none;"></div>
        </div>

        <div class="tasks-container">
            <div class="tasks-title">–ó–∞–¥–∞–Ω–∏—è</div>
            <div class="task-item" id="task-blockchain">
                <div class="task-info">
                    <span class="task-icon">üíé</span>
                    <div class="task-details">
                        <div class="task-name">Blockchain Welle</div>
                        <div class="task-reward">+100 XP</div>
                    </div>
                </div>
                <button class="task-button" onclick="completeTask('blockchain', 'https://t.me/BlockchainWelle', '@BlockchainWelle')">
                    –ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è
                </button>
            </div>
            <div class="task-item" id="task-paco">
                <div class="task-info">
                    <span class="task-icon">üíé</span>
                    <div class="task-details">
                        <div class="task-name">Paco Cartel</div>
                        <div class="task-reward">+100 XP</div>
                    </div>
                </div>
                <button class="task-button" onclick="completeTask('paco', 'https://t.me/PacoCartel', '@PacoCartel')">
                    –ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è
                </button>
            </div>
        </div>

        <div class="referral-section">
            <div class="referral-title">–ü—Ä–∏–≥–ª–∞—Å–∏ –¥—Ä—É–∑–µ–π</div>
            <div class="referral-stats">
                <div class="stat-item">
                    <span class="stat-number" id="referralCount">0</span>
                    <span class="stat-label">–†–µ—Ñ–µ—Ä–∞–ª–æ–≤</span>
                </div>
                <div class="stat-item">
                    <span class="stat-number" id="referralPoints">0</span>
                    <span class="stat-label">XP –ø–æ–ª—É—á–µ–Ω–æ</span>
                </div>
            </div>
            <div class="referral-link" id="referralLink">
                –ü–æ–¥–∫–ª—é—á–∏—Ç–µ –∫–æ—à–µ–ª–µ–∫ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Å—Å—ã–ª–∫–∏
            </div>
            <button class="copy-button" id="copyButton" onclick="copyReferralLink()" disabled>
                –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É
            </button>
        </div>
    </div>

    <script>
        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
        const CONFIG = {
            API_BASE_URL: 'https://your-api-domain.com/api',
            BOT_TOKEN: 'YOUR_BOT_TOKEN',
            BOT_USERNAME: 'your_bot_username',
            LAUNCH_DATE: new Date('2025-08-01T00:00:00Z').getTime(),
            MANIFEST_URL: 'https://your-domain.com/tonconnect-manifest.json'
        };
        
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let tg = null;
        let userId = null;
        let userWallet = null;
        let tonConnectUI = null;
        let referralCode = null;
        let countdownInterval = null;

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App
        function initTelegramWebApp() {
            if (window.Telegram && window.Telegram.WebApp) {
                tg = window.Telegram.WebApp;
                tg.expand();
                tg.setHeaderColor('#667eea');
                tg.ready();
                
                // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                if (tg.initDataUnsafe && tg.initDataUnsafe.user) {
                    userId = tg.initDataUnsafe.user.id;
                    console.log('User ID:', userId);
                }
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–π –∫–æ–¥
                if (tg.initDataUnsafe && tg.initDataUnsafe.start_param) {
                    referralCode = tg.initDataUnsafe.start_param;
                    console.log('Referral code:', referralCode);
                }
            } else {
                // Fallback –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤–Ω–µ Telegram
                console.log('Running outside Telegram, using mock data');
                userId = 'mock_user_' + Date.now();
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è TON Connect
        function initTonConnect() {
            if (typeof TonConnectUI !== 'undefined') {
                tonConnectUI = new TonConnectUI({
                    manifestUrl: CONFIG.MANIFEST_URL,
                    buttonRootId: null
                });

                tonConnectUI.onStatusChange(wallet => {
                    if (wallet) {
                        handleWalletConnection(wallet);
                    } else {
                        handleWalletDisconnection();
                    }
                });
            } else {
                console.warn('TON Connect UI not available');
            }
        }

        // API –∫–ª–∏–µ–Ω—Ç
        class ApiClient {
            constructor() {
                this.baseUrl = CONFIG.API_BASE_URL;
                this.headers = {
                    'Content-Type': 'application/json',
                    'X-Telegram-Init-Data': window.Telegram?.WebApp?.initData || ''
                };
            }

            async request(endpoint, options = {}) {
                try {
                    const response = await fetch(`${this.baseUrl}${endpoint}`, {
                        ...options,
                        headers: { ...this.headers, ...options.headers }
                    });

                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }

                    return await response.json();
                } catch (error) {
                    console.error('API request failed:', error);
                    throw error;
                }
            }

            async getUserData(userId) {
                return this.request(`/user/${userId}`);
            }

            async updateUserData(userId, data) {
                return this.request(`/user/${userId}`, {
                    method: 'POST',
                    body: JSON.stringify(data)
                });
            }

            async connectWallet(userId, walletAddress) {
                return this.request(`/user/${userId}/wallet`, {
                    method: 'POST',
                    body: JSON.stringify({ wallet: walletAddress })
                });
            }

            async completeTask(userId, taskId) {
                return this.request(`/user/${userId}/task/${taskId}`, {
                    method: 'POST'
                });
            }

            async verifySubscription(userId, channelUsername) {
                return this.request(`/verify-subscription`, {
                    method: 'POST',
                    body: JSON.stringify({ userId, channelUsername })
                });
            }

            async processReferral(userId, referrerId) {
                return this.request(`/referral`, {
                    method: 'POST',
                    body: JSON.stringify({ userId, referrerId })
                });
            }
        }

        const apiClient = new ApiClient();

        // –°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        class UserDataManager {
            constructor() {
                this.data = {
                    points: 0,
                    wallet: null,
                    tasks: {},
                    referrals: [],
                    referralPoints: 0,
                    createdAt: Date.now()
                };
            }

            async loadUserData() {
                try {
                    if (userId && CONFIG.API_BASE_URL !== 'https://your-api-domain.com/api') {
                        const userData = await apiClient.getUserData(userId);
                        this.data = { ...this.data, ...userData };
                    } else {
                        // –ò—Å–ø–æ–ª—å–∑—É–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
                        this.loadLocalData();
                    }
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', error);
                    this.loadLocalData();
                }
                
                // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–π –∫–æ–¥
                if (referralCode && referralCode !== userId) {
                    await this.processReferral(referralCode);
                }
                
                this.updateUI();
            }

            loadLocalData() {
                const saved = JSON.parse(localStorage.getItem(`user_${userId}`) || '{}');
                this.data = { ...this.data, ...saved };
            }

            async saveUserData() {
                try {
                    if (userId && CONFIG.API_BASE_URL !== 'https://your-api-domain.com/api') {
                        await apiClient.updateUserData(userId, this.data);
                    } else {
                        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ª–æ–∫–∞–ª—å–Ω–æ
                        localStorage.setItem(`user_${userId}`, JSON.stringify(this.data));
                    }
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö:', error);
                    localStorage.setItem(`user_${userId}`, JSON.stringify(this.data));
                }
            }

            async addPoints(amount, reason = '') {
                this.data.points += amount;
                this.updatePointsDisplay();
                await this.saveUserData();
                this.showNotification(`+${amount} XP`, reason);
            }

            async setWallet(wallet) {
                try {
                    this.data.wallet = wallet;
                    
                    if (CONFIG.API_BASE_URL !== 'https://your-api-domain.com/api') {
                        await apiClient.connectWallet(userId, wallet);
                    }
                    
                    await this.addPoints(1000, '–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫–æ—à–µ–ª—å–∫–∞');
                    this.updateWalletUI();
                    this.updateReferralUI();
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫–æ—à–µ–ª—å–∫–∞:', error);
                    this.showError('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫–æ—à–µ–ª—å–∫–∞');
                }
            }

            async completeTask(taskId) {
                try {
                    if (CONFIG.API_BASE_URL !== 'https://your-api-domain.com/api') {
                        await apiClient.completeTask(userId, taskId);
                    }
                    
                    this.data.tasks[taskId] = true;
                    await this.addPoints(100, '–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è');
                    this.markTaskCompleted(taskId);
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞–Ω–∏—è:', error);
                    this.showError('–û—à–∏–±–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞–Ω–∏—è');
                }
                        }

            async processReferral(referrerId) {
                if (referrerId === userId) return; // –ù–µ–ª—å–∑—è –ø—Ä–∏–≥–ª–∞—Å–∏—Ç—å —Å–∞–º–æ–≥–æ —Å–µ–±—è

                try {
                    if (!this.data.referrals.includes(referrerId)) {
                        if (CONFIG.API_BASE_URL !== 'https://your-api-domain.com/api') {
                            await apiClient.processReferral(userId, referrerId);
                        }

                        this.data.referrals.push(referrerId);
                        this.data.referralPoints += 500;
                        this.updateReferralStats();
                        await this.saveUserData();
                        this.showNotification("+500 XP", "–ü–æ —Ä–µ—Ñ–µ—Ä–∞–ª–∫–µ");
                    }
                } catch (error) {
                    console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Ä–µ—Ñ–µ—Ä–∞–ª–∞:", error);
                }
            }

            updateUI() {
                this.updatePointsDisplay();
                this.updateWalletUI();
                this.updateReferralStats();
                this.updateReferralUI();
                this.updateTaskStatus();
            }

            updatePointsDisplay() {
                document.getElementById("points").textContent = this.data.points;
            }

            updateWalletUI() {
                if (this.data.wallet) {
                    const walletText = document.getElementById("walletText");
                    walletText.textContent = this.data.wallet.slice(0, 6) + "..." + this.data.wallet.slice(-4);
                    document.getElementById("connectWallet").disabled = true;
                }
            }

            updateReferralStats() {
                document.getElementById("referralCount").textContent = this.data.referrals.length;
                document.getElementById("referralPoints").textContent = this.data.referralPoints;
            }

            updateReferralUI() {
                if (this.data.wallet && tg) {
                    const link = `https://t.me/${CONFIG.BOT_USERNAME}?start=${userId}`;
                    document.getElementById("referralLink").textContent = link;
                    document.getElementById("copyButton").disabled = false;
                }
            }

            updateTaskStatus() {
                for (const taskId in this.data.tasks) {
                    if (this.data.tasks[taskId]) {
                        this.markTaskCompleted(taskId);
                    }
                }
            }

            markTaskCompleted(taskId) {
                const taskButton = document.querySelector(`#task-${taskId} .task-button`);
                if (taskButton) {
                    taskButton.textContent = "–í—ã–ø–æ–ª–Ω–µ–Ω–æ";
                    taskButton.classList.add("completed");
                    taskButton.disabled = true;
                }
                const taskItem = document.getElementById(`task-${taskId}`);
                if (taskItem) {
                    taskItem.classList.add("completed");
                }
            }

            showNotification(message, reason = "") {
                const notification = document.createElement("div");
                notification.className = "notification";
                notification.textContent = `${message}${reason ? ` ‚Äî ${reason}` : ""}`;
                document.body.appendChild(notification);
                setTimeout(() => notification.classList.add("show"), 100);
                setTimeout(() => {
                    notification.classList.remove("show");
                    setTimeout(() => notification.remove(), 300);
                }, 3000);
            }

            showError(message) {
                const errorBox = document.getElementById("walletError");
                if (errorBox) {
                    errorBox.textContent = message;
                    errorBox.style.display = "block";
                    setTimeout(() => (errorBox.style.display = "none"), 3000);
                }
            }
        }

        const userManager = new UserDataManager();

        // –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫–æ—à–µ–ª—å–∫–∞
        async function handleWalletConnection(wallet) {
            userWallet = wallet.account.address;
            await userManager.setWallet(userWallet);
        }

        function handleWalletDisconnection() {
            console.warn("–ö–æ—à–µ–ª—ë–∫ –æ—Ç–∫–ª—é—á—ë–Ω");
        }

        // –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Å—Å—ã–ª–∫–∏
        function copyReferralLink() {
            const link = document.getElementById("referralLink").textContent;
            navigator.clipboard.writeText(link).then(() => {
                userManager.showNotification("–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞");
            });
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ –∫–∞–Ω–∞–ª
        async function completeTask(taskId, url, username) {
            const button = document.querySelector(`#task-${taskId} .task-button`);
            button.disabled = true;
            button.classList.add("checking");
            button.textContent = "–ü—Ä–æ–≤–µ—Ä–∫–∞...";

            try {
                const result = await apiClient.verifySubscription(userId, username);
                if (result.success) {
                    await userManager.completeTask(taskId);
                } else {
                    userManager.showError("–í—ã –Ω–µ –ø–æ–¥–ø–∏—Å–∞–ª–∏—Å—å –Ω–∞ –∫–∞–Ω–∞–ª");
                }
            } catch (error) {
                userManager.showError("–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–∫–∏");
            }

            button.disabled = false;
            button.classList.remove("checking");
            button.textContent = "–ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è";
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –æ–±—Ä–∞—Ç–Ω–æ–≥–æ –æ—Ç—Å—á—ë—Ç–∞
        function initCountdown() {
            countdownInterval = setInterval(() => {
                const now = Date.now();
                const distance = CONFIG.LAUNCH_DATE - now;

                if (distance < 0) {
                    clearInterval(countdownInterval);
                    document.getElementById("countdown").textContent = "–ó–∞–ø—É—Å–∫!";
                    return;
                }

                const days = Math.floor(distance / (1000 * 60 * 60 * 24));
                const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((distance % (1000 * 60)) / 1000);

                document.getElementById("days").textContent = days.toString().padStart(2, "0");
                document.getElementById("hours").textContent = hours.toString().padStart(2, "0");
                document.getElementById("minutes").textContent = minutes.toString().padStart(2, "0");
                document.getElementById("seconds").textContent = seconds.toString().padStart(2, "0");
            }, 1000);
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        window.addEventListener("load", () => {
            initTelegramWebApp();
            initTonConnect();
            initCountdown();
            userManager.loadUserData();
        });
    </script>
</body>
</html>
